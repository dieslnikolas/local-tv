services:

  # ─────────────────────────────────────────────
  #  JELLYFIN – media server
  #  http://localhost:${PORT_JELLYFIN}
  # ─────────────────────────────────────────────
  jellyfin:
    image: jellyfin/jellyfin:latest
    container_name: jellyfin
    environment:
      - TZ=${TZ}
      - JELLYFIN_PublishedServerUrl=http://${HOST_IP}:${PORT_JELLYFIN}
    volumes:
      - ./config/jellyfin:/config
      - ./config/jellyfin/cache:/cache
      - ${MEDIA_DIR}/movies:/media/movies
      - ${MEDIA_DIR}/shows:/media/shows
    ports:
      - "${PORT_JELLYFIN}:8096"       # web UI + API
      - "${PORT_JELLYFIN_DISCOVERY}:7359/udp"   # auto-discovery (Samsung TV app)
      - "${PORT_JELLYFIN_DLNA}:1900/udp"        # DLNA (Samsung TV native player)
    # devices:
      # Hardware acceleration – uncomment if needed
      # Intel iGPU:
      # - /dev/dri:/dev/dri
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8096/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # ─────────────────────────────────────────────
  #  QBITTORRENT – torrent client
  #  http://localhost:${PORT_QBITTORRENT}   user: admin  pass: see logs on first run
  # ─────────────────────────────────────────────
  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - WEBUI_PORT=8080
    volumes:
      - ./config/qbittorrent:/config
      - ${MEDIA_DIR}/downloads:/downloads
    ports:
      - "${PORT_QBITTORRENT}:8080"         # web UI
      - "${PORT_TORRENT}:6881"             # torrent port TCP
      - "${PORT_TORRENT}:6881/udp"         # torrent port UDP
    restart: unless-stopped

  # ─────────────────────────────────────────────
  #  GLANCES – system resource monitor
  #  http://localhost:${PORT_GLANCES}
  #  Shows CPU, RAM, disk usage with graphs
  # ─────────────────────────────────────────────
  glances:
    image: nicolargo/glances:latest-full
    container_name: glances
    pid: host
    environment:
      - GLANCES_OPT=-w
      - TZ=${TZ}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ${MEDIA_DIR}:/media:ro   # exposes media drive stats (/media mount point)
    ports:
      - "${PORT_GLANCES}:61208"
    restart: unless-stopped

  # ─────────────────────────────────────────────
  #  FLARESOLVERR – Cloudflare bypass proxy
  #  Used by Prowlarr for sites like 1337x
  #  http://localhost:${PORT_FLARESOLVERR}
  # ─────────────────────────────────────────────
  flaresolverr:
    image: ghcr.io/flaresolverr/flaresolverr:latest
    container_name: flaresolverr
    environment:
      - LOG_LEVEL=info
      - TZ=${TZ}
    ports:
      - "${PORT_FLARESOLVERR}:8191"
    restart: unless-stopped

  # ─────────────────────────────────────────────
  #  PROWLARR – indexer manager (torrent sites)
  #  http://localhost:${PORT_PROWLARR}
  # ─────────────────────────────────────────────
  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ./config/prowlarr:/config
    ports:
      - "${PORT_PROWLARR}:9696"
    restart: unless-stopped

  # ─────────────────────────────────────────────
  #  RADARR – movie management and auto-download
  #  http://localhost:${PORT_RADARR}
  # ─────────────────────────────────────────────
  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ./config/radarr:/config
      - ${MEDIA_DIR}/movies:/movies
      - ${MEDIA_DIR}/downloads:/downloads
    ports:
      - "${PORT_RADARR}:7878"
    restart: unless-stopped

  # ─────────────────────────────────────────────
  #  SONARR – TV show management and auto-download
  #  http://localhost:${PORT_SONARR}
  # ─────────────────────────────────────────────
  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ./config/sonarr:/config
      - ${MEDIA_DIR}/shows:/shows
      - ${MEDIA_DIR}/downloads:/downloads
    ports:
      - "${PORT_SONARR}:8989"
    restart: unless-stopped

  # ─────────────────────────────────────────────
  #  BAZARR – automatic subtitle downloads
  #  http://localhost:${PORT_BAZARR}
  # ─────────────────────────────────────────────
  bazarr:
    image: lscr.io/linuxserver/bazarr:latest
    container_name: bazarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ./config/bazarr:/config
      - ${MEDIA_DIR}/movies:/movies
      - ${MEDIA_DIR}/shows:/shows
    ports:
      - "${PORT_BAZARR}:6767"
    restart: unless-stopped

  # ─────────────────────────────────────────────
  #  HOMEPAGE – services dashboard
  #  http://localhost:${PORT_HOMEPAGE}
  # ─────────────────────────────────────────────
  homepage:
    image: ghcr.io/gethomepage/homepage:latest
    container_name: homepage
    environment:
      - TZ=${TZ}
      - HOMEPAGE_VAR_RADARR_KEY=${RADARR_API_KEY}
      - HOMEPAGE_VAR_SONARR_KEY=${SONARR_API_KEY}
      - HOMEPAGE_VAR_PROWLARR_KEY=${PROWLARR_API_KEY}
      - HOMEPAGE_VAR_JELLYFIN_KEY=${JELLYFIN_API_KEY}
      - HOMEPAGE_VAR_QBIT_PASSWORD=${QBIT_PASSWORD}
      - HOMEPAGE_VAR_BAZARR_KEY=${BAZARR_API_KEY}
    volumes:
      - ./config/homepage:/app/config
      - /var/run/docker.sock:/var/run/docker.sock:ro   # container status visibility
    ports:
      - "${PORT_HOMEPAGE}:3000"
    restart: unless-stopped

  # ─────────────────────────────────────────────
  #  WATCHTOWER – automatic image updates
  #  Runs every day at 4:00
  # ─────────────────────────────────────────────
  watchtower:
    image: containrrr/watchtower:latest
    container_name: watchtower
    environment:
      - TZ=${TZ}
      - WATCHTOWER_CLEANUP=true          # remove old images after update
      - WATCHTOWER_SCHEDULE=0 0 4 * * *  # every day at 4:00
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    restart: unless-stopped
